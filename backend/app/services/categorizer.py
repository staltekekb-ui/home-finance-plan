"""Автоматическое определение категории и типа транзакции по описанию."""

# Категории расходов
EXPENSE_KEYWORDS = {
    "Еда": [
        "пятёрочка", "пятерочка", "магнит", "лента", "перекрёсток", "перекресток",
        "дикси", "ашан", "метро", "окей", "вкусвилл", "азбука вкуса", "мясо",
        "продукты", "супермаркет", "гипермаркет", "grocery", "food"
    ],
    "Транспорт": [
        "яндекс.такси", "яндекс такси", "uber", "убер", "ситимобил", "gett",
        "такси", "метро", "мосметро", "ржд", "аэрофлот", "s7", "победа",
        "бензин", "азс", "лукойл", "газпром", "роснефть", "shell", "bp",
        "каршеринг", "делимобиль", "яндекс драйв", "парковка"
    ],
    "Развлечения": [
        "кино", "cinema", "театр", "концерт", "netflix", "spotify", "youtube",
        "кинопоиск", "ivi", "okko", "амедиатека", "steam", "playstation", "xbox",
        "боулинг", "бильярд", "клуб", "бар", "паб"
    ],
    "ЖКХ": [
        "жкх", "квартплата", "электричество", "мосэнерго", "водоканал", "газ",
        "отопление", "капремонт", "управляющая компания", "интернет", "ростелеком",
        "мтс", "билайн", "мегафон", "теле2", "связь"
    ],
    "Здоровье": [
        "аптека", "ригла", "горздрав", "36.6", "pharmacy", "поликлиника",
        "больница", "врач", "стоматолог", "анализы", "медицина", "здоровье"
    ],
    "Покупки": [
        "ozon", "wildberries", "wb", "aliexpress", "amazon", "dns", "мвидео",
        "м.видео", "эльдорадо", "ситилинк", "икеа", "ikea", "леруа", "leroy",
        "одежда", "обувь", "zara", "h&m", "uniqlo", "спортмастер"
    ],
    "Образование": [
        "курс", "обучение", "школа", "университет", "книга", "литрес",
        "skillbox", "нетология", "geekbrains", "coursera", "udemy"
    ],
    "Кафе и рестораны": [
        "ресторан", "кафе", "кофе", "кофейня", "starbucks", "старбакс",
        "макдоналдс", "mcdonalds", "бургер кинг", "kfc", "сушишоп", "суши",
        "пицца", "додо", "папа джонс", "кофемания", "шоколадница"
    ],
    "Снятие наличных": [
        "снятие наличных", "выдача наличных", "cash withdrawal", "atm",
        "банкомат", "получение наличных", "наличные"
    ],
}

# Категории доходов
INCOME_KEYWORDS = {
    "Зарплата": [
        "зарплата", "заработная плата", "оплата труда", "salary", "wage",
        "начисление з/п", "начисление зарплаты", "выплата зп"
    ],
    "Перевод от других лиц": [
        "перевод", "от", "transfer from", "пополнение", "зачисление от",
        "поступление от", "перевод по номеру", "с карты"
    ],
    "Внесение наличных": [
        "внесение наличных", "пополнение наличными", "cash deposit",
        "внесение", "внес наличные", "пополнение счета наличными"
    ],
    "Фриланс": [
        "фриланс", "freelance", "upwork", "fiverr", "заказ", "проект",
        "услуги", "выполнение работ"
    ],
    "Инвестиции": [
        "дивиденды", "купон", "dividend", "инвестиции", "акции", "облигации",
        "доход от инвестиций", "брокер", "тинькофф инвестиции"
    ],
}


def categorize_transaction(description: str) -> tuple[str | None, str]:
    """
    Определяет категорию и тип транзакции по описанию.
    Returns: (category, transaction_type)
    transaction_type: "income" or "expense"
    """
    description_lower = description.lower()

    # Check income keywords first
    for category, keywords in INCOME_KEYWORDS.items():
        for keyword in keywords:
            if keyword in description_lower:
                return (category, "income")

    # Check expense keywords
    for category, keywords in EXPENSE_KEYWORDS.items():
        for keyword in keywords:
            if keyword in description_lower:
                return (category, "expense")

    # Default to expense with no category
    return (None, "expense")


# For backward compatibility
def categorize(description: str) -> str | None:
    """Определяет категорию по описанию транзакции (старая функция для совместимости)."""
    category, _ = categorize_transaction(description)
    return category


# Mock категории для тестирования
MOCK_CATEGORIES = {
    "Пятёрочка": ("Еда", "expense"),
    "Яндекс.Такси": ("Транспорт", "expense"),
    "Ozon": ("Покупки", "expense"),
    "Лента": ("Еда", "expense"),
    "Аптека Ригла": ("Здоровье", "expense"),
    "DNS": ("Покупки", "expense"),
    "Кофемания": ("Кафе и рестораны", "expense"),
    "МВидео": ("Покупки", "expense"),
    "Зарплата": ("Зарплата", "income"),
    "Перевод от Иванова": ("Перевод от других лиц", "income"),
}
